<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.netbull.shop.databus.questionnaire.model.Questionnaire">
   
	<select id="query_Questionnaire_by_id" parameterType="long" resultType="com.netbull.shop.databus.questionnaire.model.Questionnaire">
		select * from tb_questionnaire t where t.id = #{id}
	</select>
	
	<select id="query_Questionnaires_by_doctorId" parameterType="long" resultType="com.netbull.shop.databus.questionnaire.model.Questionnaire">
		select * from tb_questionnaire t where t.doctorId = #{doctorId}
	</select>
	
	<update id="update" parameterType="java.util.Map">
        UPDATE tb_questionnaire_patient_mapping
        <set>
            <if test="state !=null and state !=''">
                state = #{state},
            </if>
            <if test="paystate !=null and paystate !=''">
                paystate = #{paystate},
            </if>
            <if test="isnotice !=null and isnotice !=''">
                isnotice = #{isnotice},
            </if>
            updateTime=now()
        </set>
        <where>
            <if test="id !=null and id !=''">
                and id = #{id}
            </if>
        </where>
    </update>
    
	<select id="queryRcentiQuestionnaires" parameterType="java.util.Map" resultType="java.util.Map">
        <![CDATA[
        	select X.*,(select u.true_name from vauth.user_info u where u.id = d.loginID) as doctorName,p.patientName from tb_questionnaire_patient_mapping X LEFT JOIN tb_medical_doctor d on X.doctorID = d.doctorID LEFT JOIN tb_medical_patient p on X.patientID = p.patientID where X.state in (0,1,2) and X.isnotice!=1 and str_to_date(X.bindTime,'%Y-%m-%d %H:%i:%s') >= date_add(now(), interval -${minitue} MINUTE)
         ]]>
    </select>
	
</mapper>